{{> header}}

<div class="content-wrapper">
    <div class="container-fluid">

  <div class="row" style="max-width: 100%; display: contents;">
    <ul class="search-customer" style="list-style: none; display:flex; justify-content: space-between; align-items: center;">
      <li class="nav-item" style="max-width: 50%;">
      </li>
      <li>
        <ul class="import_customer_button" style="list-style: none; display:flex; justify-content: space-between; align-items: center;">
          <li class="import-file_customer" style="margin-right: 10px;">
           
           <form id="uploadForm" action="/customer-manage/upload" method="POST" enctype="multipart/form-data">
              <input type="file" name="file" accept=".xlsx, .xls" id="fileInput" style="display: none;">
              <button id="importFileButton" type="button" onclick="document.getElementById('fileInput').click()" style="border-radius: 10px;">Tải lên</button>
          </form>

          </li>
          <li class="import-customer">
            <div class="action_center">
              <!-- Button to trigger the form -->
              <button id="showFormButton">Thêm mới</button>
              <!-- Modal overlay -->
              <div class="modal-overlay" id="modalOverlay">
                  <!-- Modal content -->
                  <div class="modal-content" style="width: 60%; margin: 0 auto;">
                    <!-- Form chỉnh sửa thông tin -->
                    
                        <!-- Các trường chỉnh sửa thông tin -->
                        <div class="card">
                            <div class="card-title">Thêm chủ thể</div>
                            <hr>
                            <form method="POST" action="/customer-manage/create">
                                <div class="form-group">
                                <label for="input-6">Tên</label>
                                <input type="text" class="form-control form-control-rounded" id="input-6" name="customer_name" placeholder="Điền tên của chủ thể">
                                </div>
                                <div class="form-group">
                                <label for="input-7">Số điện thoại</label>
                                <input type="text" class="form-control form-control-rounded" id="input-7" name="customer_phone" placeholder="Điền số điện thoại của chủ thể">
                                </div>
                                <div class="form-group">
                                <label for="input-8">Địa chỉ</label>
                                <input type="text" class="form-control form-control-rounded" id="input-8" name="customer_address" placeholder="Điền địa chỉ của chủ thể">
                                </div>
                                <div class="form-group py-2">
                                  <div class="icheck-material-white">
                                <input type="checkbox" id="user-checkbox2" checked=""/>
                                <label for="user-checkbox2">Tôi đồng ý với các điều khoản & điều kiện</label>
                                </div>
                                </div>
                                <div class="form-group">
                                <button type="submit" class="btn btn-light btn-round px-5"><i class="icon-lock"></i> Lưu</button>
                              </div>
                            </form>
                        </div>
                    
                  </div>
              </div>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </div>

	<div class="row" style="display: contents;">
    <div class="col-lg-6" style="max-width: 100%;">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Danh sách chủ thể</h5>
          <div class="table-responsive">
          <table id="myTable" class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Hành động</th>
                <th scope="col">Mã chủ thể</th>
                <th scope="col">Chủ thể</th>
                <th scope="col">Điện thoại</th>
                <th scope="col">Địa chỉ</th>
              </tr>
            </thead>
            <tbody>
              {{#each data}}
              <tr>
                <th scope="row" style="display: flex;">
                  <div class="action_center">
                    <button class="edit-button" onclick="toggleEditForm({{customer_id}})" style="background-color: transparent;
                    border: none;
                    cursor: pointer;">
                      <i class="icon-note" style="font-size: 20px;
                      color: white; /* Màu của icon */"></i>
                    </button>
                    <div id="editForm-{{customer_id}}" style="display: none;">
                      <!-- Form chỉnh sửa thông tin -->
                      
                          <!-- Các trường chỉnh sửa thông tin -->
                          <div class="card">
                            <div class="card-body">
                              <div class="card-title">Chỉnh sửa thông tin</div>
                              <hr>
                              <form id="editInfoForm" method="POST" action="/customer-manage/{{customer_id}}/update">
                                  <div class="form-group">
                                  <label for="input-6 customer-name">Tên</label>
                                  <input type="text" class="form-control form-control-rounded" value="{{customer_name}}" name="customer_name" id="input-6" placeholder="Điền tên của chủ thể">
                                  </div>
                                  <div class="form-group">
                                  <label for="input-7 customer-phone">Số điện thoại</label>
                                  <input type="text" class="form-control form-control-rounded" value="{{customer_phone}}" name="customer_phone" id="input-7" placeholder="Điền số điện thoại của chủ thể">
                                  </div>
                                  <div class="form-group">
                                  <label for="input-8 customer-address">Địa chỉ</label>
                                  <input type="text" class="form-control form-control-rounded" value="{{customer_address}}" name="customer_address" id="input-8" placeholder="Điền địa chỉ của chủ thể">
                                  </div>
                                  <div class="form-group py-2">
                                    <div class="icheck-material-white">
                                  <input type="checkbox" id="user-checkbox2" checked=""/>
                                  <label for="user-checkbox2">Tôi đồng ý với các điều khoản & điều kiện</label>
                                  </div>
                                  </div>
                                  <div class="form-group">
                                  <button type="submit" class="btn btn-light btn-round px-5"><i class="icon-lock"></i> Lưu</button>
                                </div>
                              </form>
                            </div>
                          </div>
                      
                    </div>
                  </div>
                  <div class="delete_action">
                    <button class="delete-button" data-id={{customer_id}} style="background-color: transparent; border: none; cursor: pointer;">
                      <i class="icon-trash" style="font-size: 20px; color:yellow; cursor: pointer;"></i>
                    </button>
                  </div>                  
                </th>
                <td>{{customer_id}}</td>
                <td>{{customer_name}}</td>
                <td>{{customer_phone}}</td>
                <td>{{customer_address}}</td>
              </tr>
              {{else}}
              <tr>
                <td colspan="9" class="text-center">Không tìm thấy từ khoá nào</td>
              </tr>
              {{/each }}
            </tbody>
          </table>
        </div>
      </div>
    </div>
	</div><!--End Row-->
    </div>
    <!-- End container-fluid-->
    
    </div><!--End content-wrapper-->

{{> footer}}

<script>
    

    function toggleEditForm(rowId) {
      var editForm = document.getElementById("editForm-" + rowId);
      if (editForm.style.display === "none") {
          // Ẩn tất cả các form chỉnh sửa trước khi hiển thị form của hàng được chọn
          var allEditForms = document.querySelectorAll("[id^='editForm-']");
          allEditForms.forEach(function(form) {
              form.style.display = "none";
          });
          editForm.style.display = "block";
      } else {
          editForm.style.display = "none";
      }
    }

    //Import Button
    function onclickEdit() {
        const file = document.getElementById('fileInput').files[0];
        const formData = new FormData();
        formData.append('file', file);
        // formData.append('id', getid);
        formData.append('customer_name', customer_name);
        formData.append('customer_phone', customer_phone);
        formData.append('customer_address', customer_address);
        formData.append('customer_id', customer_id);
        
        fetch(`/customer-manage/upload`, {
            method: 'PUT',
            body: formData,
        })
            .then(() => {
                window.location.replace('/customer-manage');
            })
    }

    //Delete Function
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function() {
            const customerId = this.getAttribute('data-id');
            if (confirm("Bạn có chắc chắn muốn xóa khách hàng này không?")) {
              console.log(customerId);
                fetch(`/customer-manage/${customerId}`, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.ok) {
                        alert('Khách hàng đã được xóa thành công!');
                        location.reload(); // Reload trang sau khi xóa
                    } else {
                        alert('Đã xảy ra lỗi khi xóa khách hàng!');
                    }
                }).catch(error => {
                    console.error('Lỗi:', error);
                    alert('Đã xảy ra lỗi khi xóa khách hàng!');
                });
            }
        });
    });

    // Function to show the modal overlay and form when the button is clicked
    document.getElementById("showFormButton").addEventListener("click", function() {
        document.getElementById("modalOverlay").style.display = "block";
    });

    // Function to close the modal if the overlay is clicked outside the form
    document.getElementById("modalOverlay").addEventListener("click", function(event) {
        if (event.target === document.getElementById("modalOverlay")) {
            document.getElementById("modalOverlay").style.display = "none";
        }
    });

    
    </script>
    